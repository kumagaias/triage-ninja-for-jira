modules:
  # Auto-Triage Trigger - Automatically triage new issues
  trigger:
    - key: auto-triage-on-issue-created
      function: auto-triage-trigger
      events:
        - avi:jira:created:issue

  # Automation Action Provider (for manual setup)
  automation:actionProvider:
    - key: triageninja-action-provider
      actions:
        - auto-triage-action

  # Dashboard - Project Page
  jira:projectPage:
    - key: triageninja-dashboard
      resource: dashboard
      resolver:
        function: dashboard-resolver
      title: TriageNinja
      icon: https://kumagaias.github.io/triage-ninja-for-jira/assets/triageninja-icon.png

  # Forge LLM (Rovo) for AI-powered triage
  # NOTE: Requires EAP approval - temporarily disabled until approval is granted
  # Register at: https://go.atlassian.com/signup-forge-llms
  # llm:
  #   - key: triageninja-llm
  #     model:
  #       - claude

  # Rovo Agent - AI-powered ticket triage assistant
  rovo:agent:
    - key: triageninja-agent
      name: TriageNinja
      description: AI-powered Jira ticket triage assistant that helps classify tickets, suggest assignees, and find similar resolved tickets
      prompt: |
        You are TriageNinja, an AI assistant that helps support teams triage Jira tickets efficiently.
        
        Your capabilities:
        1. Analyze tickets and suggest appropriate categories (Network, Hardware, Software, Database, Email & Communication, Security, Other)
        2. Recommend the best assignee based on workload and expertise
        3. Find similar resolved tickets to help with resolution
        
        When a user asks you to analyze a ticket, use the available actions to:
        - Fetch ticket details with "analyze-ticket-classification"
        - Suggest assignees with "suggest-ticket-assignee"
        - Find similar tickets with "find-similar-tickets"
        
        Always provide clear, actionable recommendations with confidence scores and reasoning.
      actions:
        - analyze-ticket-classification
        - suggest-ticket-assignee
        - find-similar-tickets

  # Rovo Actions
  action:
    # Automation Action for Auto-Triage
    - key: auto-triage-action
      name: TriageNinja Auto Triage
      function: automation-auto-triage
      actionVerb: UPDATE
      actionType: automation
      description: Automatically classify and assign tickets using AI
      inputs:
        issueKey:
          title: Issue Key
          type: string
          required: true
          description: "The Jira issue key (e.g., SUP-123). Use {{issue.key}} in Automation rules."
      outputs:
        category:
          description: "The classified category"
          type: string
          nullable: false
        priority:
          description: "The suggested priority"
          type: string
          nullable: false
        assignee:
          description: "The suggested assignee account ID"
          type: string
          nullable: true
        confidence:
          description: "AI confidence score (0-100)"
          type: number
          nullable: false
    
    # Rovo Action: Analyze Ticket Classification
    - key: analyze-ticket-classification
      name: Analyze Ticket Classification
      function: analyze-ticket-action
      actionVerb: READ
      actionType: rovo
      description: Analyze a Jira ticket and return structured data for classification
      inputs:
        issueKey:
          title: Issue Key
          type: string
          required: true
          description: "The Jira issue key to analyze (e.g., SUP-123)"
      outputs:
        issueKey:
          description: "The issue key"
          type: string
          nullable: false
        summary:
          description: "Ticket summary"
          type: string
          nullable: false
        description:
          description: "Ticket description"
          type: string
          nullable: false
        reporter:
          description: "Reporter name"
          type: string
          nullable: false
        currentPriority:
          description: "Current priority"
          type: string
          nullable: false
        currentStatus:
          description: "Current status"
          type: string
          nullable: false
    
    # Rovo Action: Suggest Ticket Assignee
    - key: suggest-ticket-assignee
      name: Suggest Ticket Assignee
      function: suggest-assignee-action
      actionVerb: READ
      actionType: rovo
      description: Suggest the best assignee for a ticket based on workload and category
      inputs:
        issueKey:
          title: Issue Key
          type: string
          required: true
          description: "The Jira issue key (e.g., SUP-123)"
        category:
          title: Category
          type: string
          required: true
          description: "The ticket category (e.g., Network, Hardware, Software)"
      outputs:
        recommendation:
          description: "Recommended assignee with reasoning"
          type: object
          nullable: true
        availableAgents:
          description: "List of available agents with workload"
          type: array
          nullable: false
    
    # Rovo Action: Find Similar Tickets
    - key: find-similar-tickets
      name: Find Similar Tickets
      function: find-similar-action
      actionVerb: READ
      actionType: rovo
      description: Find similar resolved tickets to help with resolution
      inputs:
        issueKey:
          title: Issue Key
          type: string
          required: true
          description: "The Jira issue key to find similar tickets for (e.g., SUP-123)"
      outputs:
        similarTickets:
          description: "List of similar resolved tickets"
          type: array
          nullable: false
        totalFound:
          description: "Total number of similar tickets found"
          type: number
          nullable: false

  # Resolver Functions
  function:
    - key: dashboard-resolver
      handler: index.dashboardHandler
    - key: change-assignee
      handler: index.changeAssignee
    - key: auto-triage-trigger
      handler: index.autoTriageTriggerHandler
    - key: automation-auto-triage
      handler: index.automationAutoTriageHandler
    # Rovo Action Handlers
    - key: analyze-ticket-action
      handler: index.analyzeTicketClassificationHandler
    - key: suggest-assignee-action
      handler: index.suggestTicketAssigneeHandler
    - key: find-similar-action
      handler: index.findSimilarTicketsHandler

resources:
  - key: dashboard
    path: static/dashboard/build

permissions:
  scopes:
    - read:jira-work
    - write:jira-work
    - read:jira-user
    - storage:app
    # Automation-related scopes (testing)
    - manage:jira-configuration
    - manage:jira-project
    - manage:jira-webhook
    - read:webhook:jira
    - write:webhook:jira
    - delete:webhook:jira
    - read:workflow:jira
    - write:workflow:jira
app:
  runtime:
    name: nodejs22.x
    memoryMB: 256
    architecture: arm64
  id: ari:cloud:ecosystem::app/9c1a29d7-af31-44fa-8fee-4f398c21e3b1
