modules:
  # Auto-Triage Trigger - Automatically triage new issues
  trigger:
    - key: auto-triage-on-issue-created
      function: auto-triage-trigger
      events:
        - avi:jira:created:issue

  # Automation Action Provider (for manual setup)
  automation:actionProvider:
    - key: triageninja-action-provider
      actions:
        - auto-triage-action

  # Dashboard - Project Page
  jira:projectPage:
    - key: triageninja-dashboard
      resource: dashboard
      resolver:
        function: dashboard-resolver
      title: TriageNinja
      icon: https://kumagaias.github.io/triage-ninja-for-jira/assets/triageninja-icon.png

  # Forge LLM (Rovo) for AI-powered triage
  # NOTE: Requires EAP approval - temporarily disabled until approval is granted
  # Register at: https://go.atlassian.com/signup-forge-llms
  # llm:
  #   - key: triageninja-llm
  #     model:
  #       - claude

  # Rovo Actions (kept for compatibility)
  action:
    # Automation Action for Auto-Triage
    - key: auto-triage-action
      name: TriageNinja Auto Triage
      function: automation-auto-triage
      actionVerb: UPDATE
      actionType: automation
      description: Automatically classify and assign tickets using Forge LLM AI
      inputs:
        issueKey:
          title: Issue Key
          type: string
          required: true
          description: "The Jira issue key (e.g., SUP-123). Use {{issue.key}} in Automation rules."
      outputs:
        category:
          description: "The classified category"
          type: string
          nullable: false
        priority:
          description: "The suggested priority"
          type: string
          nullable: false
        assignee:
          description: "The suggested assignee account ID"
          type: string
          nullable: true
        confidence:
          description: "AI confidence score (0-100)"
          type: number
          nullable: false

  # Resolver Functions
  function:
    - key: dashboard-resolver
      handler: index.dashboardHandler
    - key: change-assignee
      handler: index.changeAssignee
    - key: auto-triage-trigger
      handler: index.autoTriageTriggerHandler
    - key: automation-auto-triage
      handler: index.automationAutoTriageHandler

resources:
  - key: dashboard
    path: static/dashboard/build

permissions:
  scopes:
    - read:jira-work
    - write:jira-work
    - read:jira-user
    - storage:app
    # Automation-related scopes (testing)
    - manage:jira-configuration
    - manage:jira-project
    - manage:jira-webhook
    - read:webhook:jira
    - write:webhook:jira
    - delete:webhook:jira
    - read:workflow:jira
    - write:workflow:jira
app:
  runtime:
    name: nodejs22.x
    memoryMB: 256
    architecture: arm64
  id: ari:cloud:ecosystem::app/9c1a29d7-af31-44fa-8fee-4f398c21e3b1
